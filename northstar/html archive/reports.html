/**
 * NorthStar Truck Navigation - Reporting Dashboard
 * 
 * This file contains all JavaScript functionality for the reporting dashboard,
 * including chart creation, data loading, and UI updates.
 */

// =================================================================
// CONFIGURATION AND GLOBAL VARIABLES
// =================================================================
const API_ENDPOINTS = {
    getReportData: 'api.php?action=getReportData',
    getFuelData: 'api.php?action=getFuelData',
    getDriverData: 'api.php?action=getDriverData',
    getRouteData: 'api.php?action=getRouteData',
    getHeatmapData: 'api.php?action=getHeatmapData'
};

// Map instance
let map;
let routeHeatLayer;

// Chart instances
let fuelEfficiencyChart;
let mileageByDriverChart;
let fuelCostChart;
let fuelByRouteChart;
let driverEfficiencyChart;
let onTimeDeliveryChart;
let routeEfficiencyDistChart;
let topRouteCorridorsChart;

// =================================================================
// INITIALIZATION
// =================================================================
document.addEventListener('DOMContentLoaded', () => {
    console.log('Reports interface initialized');
    
    // Set up event listeners
    setupEventListeners();
    
    // Initialize date inputs for custom range
    initializeDateInputs();
    
    // Initialize map
    initMap();
    
    // Load initial report data
    loadReportData();
});

/**
 * Set up all event listeners for the dashboard
 */
function setupEventListeners() {
    // Mobile menu toggle
    const mobileMenuButton = document.getElementById('mobileMenuButton');
    const mobileMenu = document.getElementById('mobileMenu');
    
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    }
    
    // Tab switching
    document.querySelectorAll('[data-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName);
        });
    });
    
    // Date range selector
    const dateRangeSelector = document.getElementById('dateRange');
    const customDateRange = document.getElementById('customDateRange');
    
    if (dateRangeSelector && customDateRange) {
        dateRangeSelector.addEventListener('change', () => {
            if (dateRangeSelector.value === 'custom') {
                customDateRange.classList.remove('hidden');
            } else {
                customDateRange.classList.add('hidden');
            }
        });
    }
    
    // Generate report button
    const generateReportButton = document.getElementById('generateReport');
    if (generateReportButton) {
        generateReportButton.addEventListener('click', () => {
            loadReportData();
        });
    }
}

/**
 * Initialize date inputs with appropriate defaults
 */
function initializeDateInputs() {
    const startDate = document.getElementById('startDate');
    const endDate = document.getElementById('endDate');
    
    if (startDate && endDate) {
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        
        startDate.valueAsDate = thirtyDaysAgo;
        endDate.valueAsDate = today;
    }
}

/**
 * Initialize the Leaflet map
 */
function initMap() {
    const mapContainer = document.getElementById('map');
    if (!mapContainer) return;
    
    map = L.map('map').setView([39.8283, -98.5795], 4); // Center on US by default
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // Create empty layer for route heatmap
    routeHeatLayer = L.layerGroup().addTo(map);
}

/**
 * Switch between dashboard tabs
 * @param {string} tabName - The tab to switch to
 */
function switchTab(tabName) {
    // Update tab button styling
    document.querySelectorAll('[data-tab]').forEach(tab => {
        if (tab.getAttribute('data-tab') === tabName) {
            tab.classList.add('tab-active');
            tab.classList.remove('text-gray-500');
        } else {
            tab.classList.remove('tab-active');
            tab.classList.add('text-gray-500');
            tab.classList.add('border-transparent');
        }
    });
    
    // Hide all tab content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show selected tab content
    const selectedTab = document.getElementById(`${tabName}-tab`);
    if (selectedTab) {
        selectedTab.classList.remove('hidden');
    }
    
    // Load tab-specific data if needed
    switch (tabName) {
        case 'fuel':
            loadFuelData();
            break;
        case 'drivers':
            loadDriverData();
            break;
        case 'routes':
            loadRouteData();
            break;
        case 'overview':
            // Already loaded in initial load
            break;
    }
}

// =================================================================
// DATA LOADING
// =================================================================

/**
 * Load overview report data
 */
function loadReportData() {
    // Show loading overlay
    document.getElementById('loadingOverlay').style.display = 'flex';
    
    // Get date range parameters
    const dateParams = getDateRangeParams();
    
    // First try to fetch from API
    fetch(`${API_ENDPOINTS.getReportData}${dateParams}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('API request failed');
            }
            return response.json();
        })
        .then(data => {
            // Update UI with data
            updateOverviewData(data);
            
            // Hide loading overlay
            document.getElementById('loadingOverlay').style.display = 'none';
        })
        .catch(error => {
            console.error('Error loading report data:', error);
            
            // Fallback to simulated data
            console.log('Using simulated data instead');
            const simulatedData = generateSimulatedData();
            updateOverviewData(simulatedData);
            
            // Hide loading overlay
            document.getElementById('loadingOverlay').style.display = 'none';
        });
}

/**
 * Load fuel analytics data
 */
function loadFuelData() {
    // Show loading indicator for fuel tab
    document.querySelectorAll('#fuel-tab .text-2xl').forEach(element => {
        element.textContent = 'Loading...';
    });
    
    // Get date range parameters
    const dateParams = getDateRangeParams();
    
    // Try to fetch from API
    fetch(`${API_ENDPOINTS.getFuelData}${dateParams}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('API request failed');
            }
            return response.json();
        })
        .then(data => {
            // Update UI with data
            updateFuelData(data);
        })
        .catch(error => {
            console.error('Error loading fuel data:', error);
            
            // Fallback to simulated data
            console.log('Using simulated fuel data instead');
            const simulatedData = generateSimulatedFuelData();
            updateFuelData(simulatedData);
        });
}

/**
 * Load driver performance data
 */
function loadDriverData() {
    // Show loading indicator for drivers tab
    document.querySelectorAll('#drivers-tab .text-2xl').forEach(element => {
        element.textContent = 'Loading...';
    });
    
    // Get date range parameters
    const dateParams = getDateRangeParams();
    
    // Try to fetch from API
    fetch(`${API_ENDPOINTS.getDriverData}${dateParams}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('API request failed');
            }
            return response.json();
        })
        .then(data => {
            // Update UI with data
            updateDriverData(data);
        })
        .catch(error => {
            console.error('Error loading driver data:', error);
            
            // Fallback to simulated data
            console.log('Using simulated driver data instead');
            const simulatedData = generateSimulatedDriverData();
            updateDriverData(simulatedData);
        });
}

/**
 * Load route efficiency data
 */
function loadRouteData() {
    // Show loading indicator for routes tab
    document.querySelectorAll('#routes-tab .text-2xl').forEach(element => {
        element.textContent = 'Loading...';
    });
    
    // Get date range parameters
    const dateParams = getDateRangeParams();
    
    // Try to fetch from API
    fetch(`${API_ENDPOINTS.getRouteData}${dateParams}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('API request failed');
            }
            return response.json();
        })
        .then(data => {
            // Update UI with data
            updateRouteData(data);
        })
        .catch(error => {
            console.error('Error loading route data:', error);
            
            // Fallback to simulated data
            console.log('Using simulated route data instead');
            const simulatedData = generateSimulatedRouteData();
            updateRouteData(simulatedData);
        });
}

/**
 * Get date range parameters for API calls
 * @returns {string} URL parameters for date range
 */
function getDateRangeParams() {
    const dateRangeSelector = document.getElementById('dateRange');
    let params = '';
    
    if (dateRangeSelector) {
        const dateRange = dateRangeSelector.value;
        
        if (dateRange === 'custom') {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                params = `&startDate=${startDate}&endDate=${endDate}`;
            }
        } else {
            params = `&days=${dateRange}`;
        }
    }
    
    return params;
}

// =================================================================
// DATA VISUALIZATION
// =================================================================

/**
 * Update overview dashboard with data
 * @param {Object} data - Dashboard data
 */
function updateOverviewData(data) {
    // Update summary cards
    document.getElementById('totalMiles').textContent = numberWithCommas(data.totalMiles);
    document.getElementById('fuelUsed').textContent = numberWithCommas(data.fuelUsed);
    document.getElementById('avgMpg').textContent = data.avgMpg.toFixed(2);
    document.getElementById('fuelCost').textContent = formatCurrency(data.fuelCost);
    
    // Update trends
    updateTrendDisplay('totalMilesTrend', data.totalMilesTrend);
    updateTrendDisplay('fuelUsedTrend', data.fuelUsedTrend, true);
    updateTrendDisplay('avgMpgTrend', data.avgMpgTrend);
    updateTrendDisplay('fuelCostTrend', data.fuelCostTrend, true);
    
    // Update savings metrics
    document.getElementById('milesSaved').textContent = numberWithCommas(data.milesSaved);
    document.getElementById('fuelSaved').textContent = numberWithCommas(data.fuelSaved);
    document.getElementById('costSavings').textContent = formatCurrency(data.costSavings);
    
    // Update route advantages text
    document.getElementById('routeAdvantages').innerHTML = `
        <strong>NorthStar Advantage:</strong> Our truck-specific routing has avoided 
        ${data.lowClearanceAvoided} potential low clearance issues, 
        ${data.weightRestrictedAvoided} weight restricted bridges, and 
        ${data.truckProhibitedAvoided} truck-prohibited roads over this period, 
        preventing significant delays and potential fines.
    `;
    
    // Create/update charts
    createFuelEfficiencyChart(data.fuelEfficiencyData);
    createMileageByDriverChart(data.driverMileageData);
    
    // Update map with route density
    updateRouteDensityMap(data.routeDensityData);
}

/**
 * Update fuel analytics tab with data
 * @param {Object} data - Fuel data
 */
function updateFuelData(data) {
    // Update summary cards
    document.getElementById('avgCostPerGallon').textContent = formatCurrency(data.avgCostPerGallon);
    document.getElementById('totalFuelCosts').textContent = formatCurrency(data.totalFuelCosts);
    document.getElementById('fuelCostPerMile').textContent = formatCurrency(data.fuelCostPerMile);
    document.getElementById('northstarFuelSavings').textContent = formatCurrency(data.northstarFuelSavings);
    
    // Update trends
    updateTrendDisplay('avgCostPerGallonTrend', data.avgCostPerGallonTrend, false, true);
    updateTrendDisplay('totalFuelCostsTrend', data.totalFuelCostsTrend, true);
    updateTrendDisplay('fuelCostPerMileTrend', data.fuelCostPerMileTrend, true);
    updateTrendDisplay('northstarFuelSavingsTrend', data.northstarFuelSavingsTrend);
    
    // Create/update charts
    createFuelCostChart(data.fuelCostTrendData);
    createFuelByRouteChart(data.fuelByRouteData);
    
    // Update fuel efficiency table
    updateFuelEfficiencyTable(data.fuelEfficiencyByTruck);
    
    // Update fuel savings categories
    updateFuelSavingsCategories(data.fuelSavingsCategories);
    
    // Update additional savings section
    updateAdditionalSavings(data.additionalSavings);
}

/**
 * Update driver performance tab with data
 * @param {Object} data - Driver performance data
 */
function updateDriverData(data) {
    // Update summary cards
    document.getElementById('activeDrivers').textContent = data.activeDrivers;
    document.getElementById('avgMilesPerDriver').textContent = numberWithCommas(data.avgMilesPerDriver);
    document.getElementById('avgDeliveryTime').textContent = data.avgDeliveryTime;
    document.getElementById('onTimeDelivery').textContent = data.onTimeDelivery + '%';
    
    // Update trends
    updateTrendDisplay('activeDriversTrend', data.activeDriversTrend);
    updateTrendDisplay('avgMilesPerDriverTrend', data.avgMilesPerDriverTrend);
    updateTrendDisplay('avgDeliveryTimeTrend', data.avgDeliveryTimeTrend, true);
    updateTrendDisplay('onTimeDeliveryTrend', data.onTimeDeliveryTrend);
    
    // Update driver performance table
    updateDriverPerformanceTable(data.driverPerformance);
    
    // Create/update charts
    createDriverEfficiencyChart(data.driverEfficiencyData);
    createOnTimeDeliveryChart(data.onTimeDeliveryData);
    
    // Update driver insights
    updateDriverInsights(data.driverInsights);
}

/**
 * Update route efficiency tab with data
 * @param {Object} data - Route efficiency data
 */
function updateRouteData(data) {
    // Update summary cards
    document.getElementById('totalRoutes').textContent = data.totalRoutes;
    document.getElementById('avgRouteDistance').textContent = data.avgRouteDistance;
    document.getElementById('avgDeliverySpeed').textContent = data.avgDeliverySpeed;
    document.getElementById('routeEfficiencyScore').textContent = data.routeEfficiencyScore;
    
    // Update trends
    updateTrendDisplay('totalRoutesTrend', data.totalRoutesTrend);
    updateTrendDisplay('avgRouteDistanceTrend', data.avgRouteDistanceTrend, true);
    updateTrendDisplay('avgDeliverySpeedTrend', data.avgDeliverySpeedTrend);
    updateTrendDisplay('routeEfficiencyScoreTrend', data.routeEfficiencyScoreTrend);
    
    // Create/update charts
    createRouteEfficiencyDistChart(data.routeEfficiencyDistData);
    createTopRouteCorridorsChart(data.topRouteCorridorsData);
    
    // Update route comparison table
    updateRouteComparisonTable(data.routeComparison);
    
    // Update hazard avoidance stats
    updateHazardAvoidanceStats(data.hazardAvoidanceStats);
    
    // Initialize hazard map
    initHazardMap(data.hazardMapData);
}

/**
 * Update route density map
 * @param {Array} densityData - Array of route density points
 */
function updateRouteDensityMap(densityData) {
    if (!map || !routeHeatLayer) return;
    
    // Clear existing layers
    routeHeatLayer.clearLayers();
    
    // Check if heatmap plugin is available
    if (!L.heatLayer) {
        // Fallback to simple markers if heatmap not available
        densityData.forEach(point => {
            const marker = L.circleMarker([point.lat, point.lng], {
                radius: Math.sqrt(point.count) * 2,
                fillColor: '#3b82f6',
                color: '#2563eb',
                weight: 1,
                opacity: 0.8,
                fillOpacity: 0.6
            });
            
            marker.bindTooltip(`${point.count} routes pass through this area`);
            marker.addTo(routeHeatLayer);
        });
    } else {
        // Use heatmap if available
        const heatmapData = densityData.map(point => [
            point.lat,
            point.lng,
            point.count
        ]);
        
        L.heatLayer(heatmapData, {
            radius: 25,
            blur: 15,
            maxZoom: 10,
            gradient: {
                0.4: 'blue',
                0.6: 'cyan',
                0.7: 'lime',
                0.8: 'yellow',
                1.0: 'red'
            }
        }).addTo(routeHeatLayer);
    }
    
    // Fit map to show all points
    if (densityData.length > 0) {
        const bounds = L.latLngBounds(densityData.map(point => [point.lat, point.lng]));
        map.fitBounds(bounds, { padding: [50, 50] });
    }
}

/**
 * Initialize hazard avoidance map
 * @param {Object} hazardData - Hazard avoidance data
 */
function initHazardMap(hazardData) {
    const hazardMap = document.getElementById('hazardMap');
    if (!hazardMap) return;
    
    // If we already have a Leaflet map instance, reuse it
    let hazardMapInstance = hazardMap._leaflet_id ? 
        hazardMap._leaflet_obj : 
        L.map(hazardMap).setView([39.8283, -98.5795], 4);
    
    // Save map instance
    hazardMap._leaflet_obj = hazardMapInstance;
    
    // Clear existing layers
    hazardMapInstance.eachLayer(layer => {
        hazardMapInstance.removeLayer(layer);
    });
    
    // Add base tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(hazardMapInstance);
    
    // Add hazard points
    if (hazardData && hazardData.hazards) {
        // Create icon for each hazard type
        const icons = {
            lowClearance: L.divIcon({
                html: '<div class="h-4 w-4 rounded-full bg-red-500 border-2 border-white"></div>',
                className: 'hazard-icon',
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            }),
            weightRestricted: L.divIcon({
                html: '<div class="h-4 w-4 rounded-full bg-yellow-500 border-2 border-white"></div>',
                className: 'hazard-icon',
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            }),
            truckProhibited: L.divIcon({
                html: '<div class="h-4 w-4 rounded-full bg-purple-500 border-2 border-white"></div>',
                className: 'hazard-icon',
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            })
        };
        
        // Add markers for each hazard
        hazardData.hazards.forEach(hazard => {
            const marker = L.marker([hazard.lat, hazard.lng], {
                icon: icons[hazard.type] || icons.truckProhibited
            });
            
            marker.bindTooltip(`${hazard.description} - Avoided on ${hazard.date}`);
            marker.addTo(hazardMapInstance);
        });
        
        // Fit map to show all hazards
        if (hazardData.hazards.length > 0) {
            const bounds = L.latLngBounds(hazardData.hazards.map(hazard => [hazard.lat, hazard.lng]));
            hazardMapInstance.fitBounds(bounds, { padding: [20, 20] });
        }
    }
}

// =================================================================
// CHART CREATION
// =================================================================

/**
 * Create fuel efficiency trend chart
 * @param {Object} data - Chart data
 */
function createFuelEfficiencyChart(data) {
    const ctx = document.getElementById('fuelEfficiencyChart');
    if (!ctx) return;
    
    // Destroy existing chart if it exists
    if (fuelEfficiencyChart) {
        fuelEfficiencyChart.destroy();
    }
    
    // Create new chart
    fuelEfficiencyChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Avg MPG',
                data: data.mpgData,
                borderColor: 'rgba(59, 130, 246, 0.8)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Industry Avg',
                data: data.industryAvgData,
                borderColor: 'rgba(156, 163, 175, 0.8)',
                borderDash: [5, 5],
                tension: 0.4,
                fill: false
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: 'Miles Per Gallon'
                    }
                }
            }
        }
    });
}

/**
 * Create mileage by driver chart
 * @param {Object} data - Chart data
 */
function createMileageByDriverChart(data) {
    const ctx = document.getElementById('mileageByDriverChart');
    if (!ctx) return;
    
    // Destroy existing chart if it exists
    if (mileageByDriverChart) {
        mileageByDriverChart.destroy();
    }
    
    // Create new chart
    mileageByDriverChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Miles',
                data: data.mileageData,
                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Total Miles'
                    }
                }
            }
        }
    });
}

/**
 * Create fuel cost trend chart
 * @param {Object} data - Chart data
 */
function createFuelCostChart(data) {
    const ctx = document.getElementById('fuelCostChart');
    if (!ctx) return;
    
    // Destroy existing chart if it exists
    if (fuelCostChart) {
        fuelCostChart.destroy();
    }
    
    // Create new chart
    fuelCostChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Fuel Cost',
                data: data.costData,
                borderColor: 'rgba(220, 38, 38, 0.8)',
                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Fuel Price ($/gal)',
                data: data.priceData,
                borderColor: 'rgba(245, 158, 11, 0.8)',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                borderDash: [5, 5],
                tension: 0.4,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.datasetIndex === 0) {
                                label += formatCurrency(context.raw);
                            } else {
                                label += formatCurrency(context.raw, 0);
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Total Cost ($)'
                    }
                },
                y1: {
                    position: 'right',
                    grid: {
                        drawOnChartArea: false
                    },
                    title: {
                        display: true,
                        text: 'Price ($/gal)'
                    }
                }
            }
        }
    });
}

/**
 * Create fuel usage by route type chart
 * @param {Object} data - Chart data
 */
function createFuelByRouteChart(data) {
    const ctx = document.getElementById('fuelByRouteChart');
    if (!ctx) return;
    
    // Destroy existing chart if it exists
    if (fuelByRouteChart) {
        fuelByRouteChart.destroy();
    }
    
    // Create new chart
    fuelByRouteChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.fuelData,
                backgroundColor: [
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(16, 185, 129, 0.7)',
                    'rgba(245, 158, 11, 0.7)',
                    'rgba(139, 92, 246, 0.7)',
                    'rgba(236, 72, 153, 0.7)'
                ],
                borderColor: [
                    'rgba(59, 130, 246, 1)',
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(139, 92, 246, 1)',
                    'rgba(236, 72, 153, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.raw.toLocaleString() + ' gallons';
                            return label;
                        }
                    }
                }
            }
        }
    });
}

/**
 * Create driver efficiency comparison chart
 * @param {Object} data - Chart data
 */
function createDriverEfficiencyChart(data) {
    const ctx = document.getElementById('driverEfficiencyChart');
    if (!ctx) return;
    
    // Destroy existing chart if it exists
    if (driverEfficiencyChart) {
        driverEfficiencyChart.destroy();
    }
    
    // Create new chart
    driverEfficiencyChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: data.categories,
            datasets: data.drivers.map((driver, index) => ({
                label: driver.name,
                data: driver.scores,
                backgroundColor: `rgba(${getColorCode(index)}, 0.2)`,
                borderColor: `rgba(${getColorCode(index)}, 1)`,
                borderWidth: 2,
                pointBackgroundColor: `rgba(${getColorCode(index)}, 1)`,
                pointRadius: 4
            }))
        },
        options: {
            responsive: true,
            scales: {
                r: {
                    min: 0,
                    max: 100,
                    ticks: {
                        stepSize: 20
                    }
                }
            }
        }
    });
}

/**
 * Create on-time delivery performance chart
 * @param {